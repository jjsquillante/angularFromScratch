//(c) Copyright 2015 Pivotal Software, Inc. All Rights Reserved.
'use strict';

var _promise = require('babel-runtime/core-js/promise');

var _promise2 = _interopRequireDefault(_promise);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _weakMap = require('babel-runtime/core-js/weak-map');

var _weakMap2 = _interopRequireDefault(_weakMap);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var privates = new _weakMap2.default();

var JasminePlugin = function () {
  function JasminePlugin() {
    (0, _classCallCheck3.default)(this, JasminePlugin);

    var resolve = function resolve() {};
    var reject = function reject() {};
    var promise = new _promise2.default(function (res, rej) {
      resolve = res;
      reject = rej;
    });

    privates.set(this, { promise: promise, resolve: resolve, reject: reject });

    this.whenReady = function () {
      return privates.get(this).promise;
    }.bind(this);
  }

  JasminePlugin.prototype.apply = function apply(compiler) {
    var _this = this;

    compiler.plugin('invalid', function () {
      var _privates$get = privates.get(_this);

      var resolve = _privates$get.resolve;
      var reject = _privates$get.reject;
      var promise = _privates$get.promise;

      reject();
      promise = new _promise2.default(function (res, rej) {
        resolve = res;
        reject = rej;
      });
      privates.set(_this, { promise: promise, resolve: resolve, reject: reject });
      return promise;
    });
    compiler.plugin('done', function () {
      return privates.get(_this).resolve();
    });
  };

  return JasminePlugin;
}();

module.exports = JasminePlugin;